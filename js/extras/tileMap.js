// tileMap is holding the tileset
// 0: blocked;
// 1: moveable;

// Global tileset variables
const tilesetURL = "../../media/images/tileset.png";
let tileset = null;
let tilesetLoaded = false;

// Floortypes
const floorTypes = {
  solid: 0,
  path: 1,
  water: 2,
  ice: 3,
  conveyorU: 4,
  conveyorD: 5,
  conveyorL: 6,
  conveyorR: 7,
  grass: 8
};

// Tiletypes
const tileTypes = {
  0: {
    color: "#685b48",
    floor: floorTypes.solid,
    sprite: [{ x: 0, y: 0, w: 40, h: 40 }]
  },
  1: {
    color: "#5aa457",
    floor: floorTypes.grass,
    sprite: [{ x: 40, y: 0, w: 40, h: 40 }]
  },
  2: {
    color: "#e8bd7a",
    floor: floorTypes.path,
    sprite: [{ x: 80, y: 0, w: 40, h: 40 }]
  },
  3: {
    color: "#286625",
    floor: floorTypes.solid,
    sprite: [{ x: 120, y: 0, w: 40, h: 40 }]
  },
  4: {
    color: "#678fd9",
    floor: floorTypes.water,
    sprite: [
      { x: 160, y: 0, w: 40, h: 40, d: 200 },
      { x: 200, y: 0, w: 40, h: 40, d: 200 },
      { x: 160, y: 40, w: 40, h: 40, d: 200 },
      { x: 200, y: 40, w: 40, h: 40, d: 200 },
      { x: 160, y: 40, w: 40, h: 40, d: 200 },
      { x: 200, y: 0, w: 40, h: 40, d: 200 }
    ]
  },
  5: {
    color: "#eeeeff",
    floor: floorTypes.ice,
    sprite: [{ x: 120, y: 120, w: 40, h: 40 }]
  },
  6: {
    color: "#cccccc",
    floor: floorTypes.conveyorL,
    sprite: [
      { x: 0, y: 40, w: 40, h: 40, d: 200 },
      { x: 40, y: 40, w: 40, h: 40, d: 200 },
      { x: 80, y: 40, w: 40, h: 40, d: 200 },
      { x: 120, y: 40, w: 40, h: 40, d: 200 }
    ]
  },
  7: {
    color: "#cccccc",
    floor: floorTypes.conveyorR,
    sprite: [
      { x: 120, y: 80, w: 40, h: 40, d: 200 },
      { x: 80, y: 80, w: 40, h: 40, d: 200 },
      { x: 40, y: 80, w: 40, h: 40, d: 200 },
      { x: 0, y: 80, w: 40, h: 40, d: 200 }
    ]
  },
  8: {
    color: "#cccccc",
    floor: floorTypes.conveyorD,
    sprite: [
      { x: 160, y: 200, w: 40, h: 40, d: 200 },
      { x: 160, y: 160, w: 40, h: 40, d: 200 },
      { x: 160, y: 120, w: 40, h: 40, d: 200 },
      { x: 160, y: 80, w: 40, h: 40, d: 200 }
    ]
  },
  9: {
    color: "#cccccc",
    floor: floorTypes.conveyorU,
    sprite: [
      { x: 200, y: 80, w: 40, h: 40, d: 200 },
      { x: 200, y: 120, w: 40, h: 40, d: 200 },
      { x: 200, y: 160, w: 40, h: 40, d: 200 },
      { x: 200, y: 200, w: 40, h: 40, d: 200 }
    ]
  }
};

getFrame = (sprite, duration, time, animated) => {
  if (!animated) {
    return sprite[0];
  }
  time = time % duration;

  for (x in sprite) {
    if (sprite[x].end >= time) {
      return sprite[x];
    }
  }
};

// Current tileset
// 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
// 0, 2, 1, 2, 4, 2, 1, 7, 7, 7, 1, 1, 1, 1, 1, 1, 0, 2, 2, 0,
// 0, 2, 1, 0, 4, 0, 1, 9, 1, 1, 1, 1, 1, 1, 1, 1, 0, 2, 2, 0,
// 0, 2, 1, 1, 4, 1, 1, 9, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 0,
// 0, 2, 1, 1, 4, 1, 1, 9, 2, 3, 3, 2, 1, 1, 2, 1, 0, 0, 0, 0,
// 0, 2, 2, 2, 4, 2, 2, 2, 2, 3, 3, 2, 2, 2, 2, 1, 1, 1, 1, 0,
// 0, 2, 1, 1, 4, 2, 4, 1, 1, 1, 1, 6, 6, 6, 2, 1, 1, 1, 1, 0,
// 4, 4, 4, 4, 4, 2, 4, 1, 1, 1, 1, 8, 1, 1, 2, 1, 1, 1, 1, 0,
// 0, 2, 5, 1, 5, 2, 4, 4, 4, 4, 4, 8, 1, 1, 2, 2, 2, 2, 1, 0,
// 0, 1, 5, 5, 5, 2, 3, 2, 1, 1, 4, 8, 1, 1, 1, 3, 3, 2, 1, 0,
// 0, 1, 2, 2, 2, 2, 1, 2, 1, 1, 4, 1, 1, 1, 1, 1, 3, 2, 1, 0,
// 0, 1, 2, 3, 3, 2, 1, 2, 1, 1, 4, 4, 4, 4, 4, 4, 4, 2, 4, 4,
// 0, 1, 2, 3, 3, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 0,
// 0, 1, 2, 3, 4, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 0, 1, 2, 1, 0,
// 0, 3, 2, 3, 4, 4, 1, 2, 2, 2, 2, 2, 2, 2, 1, 0, 1, 2, 1, 0,
// 0, 3, 2, 3, 4, 4, 3, 2, 1, 1, 1, 1, 1, 2, 1, 1, 1, 2, 3, 0,
// 0, 3, 2, 3, 4, 1, 3, 2, 1, 3, 1, 1, 1, 2, 1, 1, 1, 2, 3, 0,
// 0, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 1, 1, 2, 2, 2, 2, 2, 3, 0,
// 0, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 4, 0,
// 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0

const tileMap = [
  0,
  0,
  0,
  0,
  4,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  2,
  1,
  2,
  4,
  2,
  1,
  7,
  7,
  7,
  1,
  1,
  1,
  1,
  1,
  1,
  0,
  2,
  2,
  0,
  0,
  2,
  1,
  0,
  4,
  0,
  1,
  9,
  1,
  1,
  1,
  1,
  1,
  1,
  1,
  1,
  0,
  2,
  2,
  0,
  0,
  2,
  1,
  1,
  4,
  1,
  1,
  9,
  2,
  2,
  2,
  2,
  1,
  1,
  2,
  2,
  2,
  2,
  2,
  0,
  0,
  2,
  1,
  1,
  4,
  1,
  1,
  9,
  2,
  3,
  3,
  2,
  1,
  1,
  2,
  1,
  0,
  0,
  0,
  0,
  0,
  2,
  2,
  2,
  4,
  2,
  2,
  2,
  2,
  3,
  3,
  2,
  2,
  2,
  2,
  1,
  1,
  1,
  1,
  0,
  0,
  2,
  1,
  1,
  4,
  2,
  4,
  1,
  1,
  1,
  1,
  6,
  6,
  6,
  2,
  1,
  1,
  1,
  1,
  0,
  4,
  4,
  4,
  4,
  4,
  2,
  4,
  1,
  1,
  1,
  1,
  8,
  1,
  1,
  2,
  1,
  1,
  1,
  1,
  0,
  0,
  2,
  5,
  1,
  5,
  2,
  4,
  4,
  4,
  4,
  4,
  8,
  1,
  1,
  2,
  2,
  2,
  2,
  1,
  0,
  0,
  1,
  5,
  5,
  5,
  2,
  3,
  2,
  1,
  1,
  4,
  8,
  1,
  1,
  1,
  3,
  3,
  2,
  1,
  0,
  0,
  1,
  2,
  2,
  2,
  2,
  1,
  2,
  1,
  1,
  4,
  1,
  1,
  1,
  1,
  1,
  3,
  2,
  1,
  0,
  0,
  1,
  2,
  3,
  3,
  2,
  1,
  2,
  1,
  1,
  4,
  4,
  4,
  4,
  4,
  4,
  4,
  2,
  4,
  4,
  0,
  1,
  2,
  3,
  3,
  2,
  1,
  2,
  1,
  1,
  1,
  1,
  1,
  1,
  1,
  1,
  1,
  2,
  1,
  0,
  0,
  1,
  2,
  3,
  4,
  2,
  2,
  2,
  1,
  1,
  1,
  1,
  1,
  1,
  1,
  0,
  1,
  2,
  1,
  0,
  0,
  3,
  2,
  3,
  4,
  4,
  1,
  2,
  2,
  2,
  2,
  2,
  2,
  2,
  1,
  0,
  1,
  2,
  1,
  0,
  0,
  3,
  2,
  3,
  4,
  4,
  3,
  2,
  1,
  1,
  1,
  1,
  1,
  2,
  1,
  1,
  1,
  2,
  3,
  0,
  0,
  3,
  2,
  3,
  4,
  1,
  3,
  2,
  1,
  3,
  1,
  1,
  1,
  2,
  1,
  1,
  1,
  2,
  3,
  0,
  0,
  1,
  2,
  2,
  2,
  2,
  2,
  2,
  3,
  3,
  3,
  1,
  1,
  2,
  2,
  2,
  2,
  2,
  3,
  0,
  0,
  1,
  1,
  1,
  1,
  1,
  1,
  3,
  3,
  3,
  3,
  3,
  1,
  1,
  1,
  1,
  1,
  1,
  4,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
];
